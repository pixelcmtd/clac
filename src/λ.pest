// TODO: rename everything to be sensible

// https://en.wikipedia.org/wiki/Template:Whitespace_(Unicode)
WHITESPACE = _{ "\t" | " " | "\u{00A0}" | "\u{1680}" | '\u{2000}'..'\u{200A}' | "\u{202F}" | "\u{205F}" | "\u{3000}" | "," }
// TODO: more creative comments (an idea would be emoji like ğŸ’­ but that wouldnt be mathy)
// NOTE: maybe we don't even need to do comments in here because if the evaluation system
//       is well enough designed we can just write ANYTHING (and maybe have a comment
//       function that throws away all parameters, something like K F)
COMMENT = { "#" ~ (!NEWLINE ~ ANY)* }

mvariable = @{ !(WHITESPACE | "#" | NEWLINE | "(" | ")" | "$" | "â†" | "â‡" | "Î»" | "." | ";" | "âˆˆ" | "Î›" | "â†’" | "âˆª" ) ~ ANY }
variable = @{ mvariable+ }
item = { variable | "(" ~ expr ~ ")" | "$" ~ expr }
mitem = { mvariable | "(" ~ mexpr ~ ")" | "$" ~ mexpr }

vardef = { variable ~ "â†" ~ expr | variable ~ "â‡" ~ mexpr }

expr = { func | item+ }
mexpr = { mfunc | mitem+ }

params = { variable+ }
mparams = { mvariable+ }
body = { expr }
mbody = { mexpr }
func = { "Î»" ~ params ~ "." ~ body }
mfunc = { "Î»" ~ mparams ~ "." ~ mbody } //~ ("âˆˆ" ~ ty)?

typedef = { variable ~ "âˆˆ" ~ ty }
pty = _{ "(" ~ ty ~ ")" | "$" ~ ty }
paramty = { pty | unionty | variable }
bodyty = { ty }
functy = { paramty ~ "â†’" ~ bodyty }
u1ty = { pty | variable }
u2ty = { pty | unionty | variable }
unionty = { u1ty ~ "âˆª"? ~ u2ty }
// TODO: Ï€-expansion for types
argty = { variable }
funty = { "Î›" ~ argty ~ "." ~ bodyty }
// FIXME: applications:
// Î›x.(a â†’ b) x â†’ Î›x.a â†’ b âˆª x
// Î›x.(b) x     â†’ Î›x.b âˆª x
ty = _{ funty | functy | unionty | pty | variable }

statement = _{ vardef | typedef | expr }
// TODO: think about using something other than ;
statements = _{ SOI ~ (NEWLINE | ";")* ~ (statement ~ (NEWLINE | ";")+)* ~ statement? ~ EOI }

// TODO:
// we can support a Î¼hs syntax in here too we just need an assignment that is I x â‰” x
// also we can support a maths like syntax: I: ğ“ â†¦ ğ“
